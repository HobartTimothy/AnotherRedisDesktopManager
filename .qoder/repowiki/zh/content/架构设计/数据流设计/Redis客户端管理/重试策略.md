# 重试策略

<cite>
**Referenced Files in This Document**   
- [redisClient.js](file://src/redisClient.js)
</cite>

## 目录
1. [重试机制概述](#重试机制概述)
2. [重试次数与限制](#重试次数与限制)
3. [退避算法分析](#退避算法分析)
4. [错误处理与用户反馈](#错误处理与用户反馈)
5. [实际场景应用](#实际场景应用)

## 重试机制概述

该重试策略通过 `retryStrategy` 函数实现连接失败后的自动重试机制。该函数被集成在 Redis 客户端的连接选项中，当连接失败时会根据重试次数计算等待时间，实现指数退避重试。该机制通过控制重试次数和退避时间，有效平衡了快速恢复连接与系统负载之间的关系。

**Section sources**
- [redisClient.js](file://src/redisClient.js#L210-L233)

## 重试次数与限制

`times` 参数表示当前重试的次数，从1开始递增。系统设置了 `maxRetryTimes = 3` 的限制，即最多允许进行3次重试。当 `times >= maxRetryTimes` 时，系统将停止重试并执行最终的错误处理。这种限制机制有效防止了无限重试导致的资源浪费和系统阻塞，确保在持续连接失败的情况下能够及时终止重试过程，避免对系统造成不必要的负担。

**Section sources**
- [redisClient.js](file://src/redisClient.js#L344-L346)

## 退避算法分析

退避算法采用 `Math.min(times * 200, 1000)` 的计算逻辑，实现了指数退避策略。具体计算规则如下：
- 首次重试（times=1）：等待 1 * 200 = 200ms
- 第二次重试（times=2）：等待 2 * 200 = 400ms
- 第三次及以上重试（times≥3）：等待 min(3 * 200, 1000) = 600ms，但由于上限为1000ms，实际等待时间为1000ms

该算法通过逐步增加等待时间，避免了在短时间内频繁重试对服务器造成的压力，同时保证了在初期能够快速尝试恢复连接。

**Section sources**
- [redisClient.js](file://src/redisClient.js#L353)

## 错误处理与用户反馈

当达到最大重试次数后，系统会通过 `vue.$message.error` 向用户显示错误提示，告知连接失败的情况。同时，系统会触发 `closeConnection` 事件来终止连接尝试，释放相关资源。这种处理方式既保证了用户体验，让用户及时了解连接状态，又确保了系统资源的有效管理，避免了无效的连接尝试持续占用系统资源。

**Section sources**
- [redisClient.js](file://src/redisClient.js#L346)

## 实际场景应用

在实际网络波动场景中，该策略能够有效平衡快速恢复与系统负载。在网络短暂中断时，前两次较短的等待时间（200ms和400ms）能够快速尝试恢复连接，减少用户等待时间。当网络问题持续存在时，逐步增加的等待时间避免了对服务器的频繁冲击，降低了系统负载。最大3次重试的限制确保了在严重网络故障时不会无限重试，及时终止连接尝试并通知用户，实现了可靠性与性能的平衡。